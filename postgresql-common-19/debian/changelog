postgresql-common (19) unstable; urgency=low

  * debian/postgresql-common.postinst: Generate an SSL certificate and key if
    it doesn't exist yet and openssl is installed. Closes: #212526
  * debian/control: Recommend openssl and explain its purpose.
  * pg_createcluster: If SSL certificate and key exist, symlink it to the
    cluster directory where the postmaster looks for them and enable SSL in
    the configuration.

 -- Martin Pitt <mpitt@debian.org>  Sun, 19 Jun 2005 01:02:48 +0200

postgresql-common (18) unstable; urgency=low

  * pg_ctlcluster: Change directory to /var/lib/postgresql to avoid error
    messages when doing an operation in a directory which the database owner
    cannot access.
  * pg_ctlcluster: Pass the default socket directory to the postmaster,
    otherwise it will always be /tmp if unix_socket_directory is not specified
    in postgresql.conf. Closes: #314537
  * Added tests/041_server_default_socketdir: Check that the socket is created
    in /var/run/postgresql if unix_socket_directory is not specified.
  * pg_ctlcluster:
    - On startup, check for a stale or invalid PID file and remove it if
      appropriate.
    - On stop, bail out on an invalid PID file. Closes: #304466.
  * Added tests/021_invalid_pidfile: Corrupt the pid file in various ways
    while the server is running and down. Also check double start/stop.

 -- Martin Pitt <mpitt@debian.org>  Sat, 18 Jun 2005 20:30:10 +0200

postgresql-common (17) unstable; urgency=low

  * PgCommon.pm, cluster_port_running(): Attempt to connect() to the server
    socket for probing if the server is running. The previous method of using
    'psql -l' asked for a password if md5/password authentication is used
    locally. Closes: #314292
  * testsuite: Ignore whitespace changes in expected vs. actual output.
  * tests/100_encodings: Fix race condition when showing postmaster processes:
    If we catch the postmaster right at fork() time, ps shows two postmaster
    instances instead of one. Filter them away to get the expected output.

 -- Martin Pitt <mpitt@debian.org>  Thu, 16 Jun 2005 11:44:08 +0200

postgresql-common (16) unstable; urgency=low

  * pg_createcluster: Add --logfile parameter.
  * pg_wrapper(1): Clarify synopsis.
  * debian/rules: Deuglify manpages by building them with --quotes=none.
  * debian/maintscripts-functions: Do not create a default "main" cluster when
    upgrading a server package.
  * pg_upgradecluster: Handle more configuration parameter transitions:
    - syslog -> log_destination
    - log_statement: false/true -> none/all
    - log_{pid,timestamp,hostname,source_port} -> log_line_prefix
    - obsolete max_expr_depth
  * pg_upgradecluster: Use new replace_conf_value() function which
    produces nicer configuration files with transitioned parameters.
  * Add test 120_obsolete_confparams: Upgrade a 7.4 cluster with all
    possible 7.4 options enabled.
  * PgCommon.pm: Fix parsing of autovacuum parameters.
  * pg_ctlcluster: Respect the avac_debug autovacuum configuration option.
  * pg_createcluster: Since the new default socket directory is
    /var/run/postgresql, explicitly set /tmp as socket directory for clusters
    if /var/run/postgresql is not writable by the cluster owner.
  * PgCommon.pm, get_cluster_socketdir(): If unix_socket_directory is not
    specified explicitly in postgresql.conf, default to /var/run/postgresql
    for postgres-owned clusters. Closes: #313651
  * pg_ctlcluster: Do not sleep at all after starting the postmaster if we
    don't run the autovacuum daemon; sleep for a full second if we do.

 -- Martin Pitt <mpitt@debian.org>  Wed, 15 Jun 2005 01:01:11 +0200

postgresql-common (15) unstable; urgency=low

  * First unstable upload, welcome to the PostgreSQL future.
  * Quiet maintenance:
    - pg_maintenance: Supply -q to vacuumdb unless in verbose mode.
    - postgresql-common.cron.d: Direct stdout to /dev/null.
    - Adapted tests/060_maintenance expected output.
    - Closes: #312298

 -- Martin Pitt <mpitt@debian.org>  Tue,  7 Jun 2005 12:11:48 +0200

postgresql-common (14) experimental; urgency=low

  * pg_ctlcluster: Check whether mutually exclusive log_*_stats are enabled
    to avoid the "FATAL:  invalid cache id: 30" error on client invocations.
  * Added test 110_invalid_conf: test checking of invalid configurations.
  * Ship test suite in /usr/share/postgresql-common.
  * pg_ctlcluster: Fix logging of autovacuum daemon.
  * pg_ctlcluster: Check if autovacuum daemon is really running, exit with an
    error and print log if not.

 -- Martin Pitt <mpitt@debian.org>  Sun,  5 Jun 2005 11:19:08 +0200

postgresql-common (13) experimental; urgency=low

  * pg_createcluster: Add option --start to start the new cluster right after
    creating it.
  * tests/000_existing_clusters: Check for stale postmaster and pg_autovacuum
    processes.
  * testsuite:
    - Temporarily stop existing servers and move away existing files before
      executing the tests.
    - Restore the original files after the tests.
  * pg_upgradecluster: Check return value of pg_dumpall and psql and fail if
    they are not successful.
  * pg_createuser: Fix indentation of socket warning.
  * pg_upgradecluster: Check if cluster is running, exit with an error if not.
  * pg_createcluster: Added option --encoding to override detection from
    locale.
  * pg_createcluster: Guess default encoding from locale for clusters older
    than 8.0 to get the same behaviour as for 8.0.
  * debian/control: Conflict to postgresql-7.4 << 1:7.4.8-5 since earlier
    versions do not support non-ASCII encodings (due to missing pg_encoding).
  * pg_ctlcluster: Check that the cluster owner uid/gid really exist.
    Closes: #311546
  * pg_lsclusters: Ensure that there is at least one space between the colums.
  * Added tests/100_encodings which checks cluster creation and updates
    for different encodings and locales.
  * pg_upgradecluster: Preserve socket directory, locales, and encoding.
  * tests/100_encodings: Check the locale the postmaster is running under.

 -- Martin Pitt <mpitt@debian.org>  Sat,  4 Jun 2005 15:44:40 +0200

postgresql-common (12) experimental; urgency=low

  * pg_ctlcluster: Remove "status" command, it's not documented and not
    really useful.
  * PgCommon: Fix cluster_info for avac_logfile to make pg_dropcluster clean
    away the autovacuum log file.
  * pg_maintenance: -v only influences vacuumdb output now, always show
    clusters.
  * Added a test suite:
    - Test scripts are in tests/*.
    - Expected output is in tests/*.ex.
    - Test suite is run with './testsuite' as root.
  * pg_createcluster:
    - Converted optional third parameter to option --datadir.
    - Rework POD to have a separate OPTIONS section.
    - Add option description to online help.
  * pg_ctlcluster: Improve POD.
  * pg_upgradecluster:
    - Initial framework for handling obsolete configuration parameters.
    - Handle transition of {tcpip_socket, virtual_host} -> listen_addresses.
  * debian/init.d-functions: If /lib/lsb/init-functions is available, use LSB
    init script functions.
  * pg_ctlcluster: After start, check whether the cluster is really running.
    If it does not come up after 5 seconds, fail and print the recent log
    portion.

 -- Martin Pitt <mpitt@debian.org>  Tue, 31 May 2005 12:16:26 +0200

postgresql-common (11) experimental; urgency=low

  * pg_ctlcluster: Cleaned up variables.
  * Factored out change_ugid() to PgCommon.pm and use it in the scripts.
  * Added pg_maintenance(8) program.
  * Activated formerly disabled postgresql-common.cron.d which calls
    pg_maintenance.
  * pg_createcluster: Default to cluster owner 'postgres' if no owner is
    specified.
  * pg_ctlcluster: Fix pg_controldata output parsing and call pg_controldata
    under locale 'C' to work with all locales. Closes: #310716
  * pg_createcluster: Added --socket-dir option.
  * PgCommon.pm: Fix declaration of @lines in set_conf_value() to avoid
    duplicating the lines in configuration files.
  * PgCommon.pm: Converted to use strict to avoid future errors.
  * pg_maintenance: Removed option '-e' from vacuumdb call (leftover from
    debugging).
  * PgCommon.pm, user_cluster_map(): If several clusters exist, but no
    mapping is configured, return not only the default port's cluster version,
    but also its name. This fixes the socket directory determination for this
    case.
  * debian/rules: Fix clean target to remove the manpages created from POD
    again.
  * pg_upgradecluster: Provide socket directory arguments to psql and
    pg_dumpall to make it work for sockets which are not in /tmp.

 -- Martin Pitt <mpitt@debian.org>  Sat, 28 May 2005 16:02:59 +0200

postgresql-common (10) experimental; urgency=low

  * pg_ctlcluster: Supply cluster socket directory to pg_autovacuum.

 -- Martin Pitt <mpitt@debian.org>  Tue, 24 May 2005 22:57:33 +0200

postgresql-common (9) experimental; urgency=low

  * Add README.Debian with some general introduction, "first steps for the
    impatient", and pointers to further documentation.
  * pg_ctlcluster: Check validity of postmaster locale before setting it.
  * pg_createcluster: Check validity of locale before calling initdb under it.
  * pg_wrapper: Support PGCLUSTER environment variable. Closes: #305912
  * pg_upgradecluster:
    - Copy original configuration files.
    - Configure the target cluster to use the original port, move the old
      cluster to a previously unused port.
    - Start the new cluster after upgrade.
  * debian/init.d-functions: Create /var/run/postgresql if it does not exist.
  * pg_createcluster: Set the socket directory to /var/run/postgresql for
    postgres-owned clusters. Print a warning to change the directory for other
    owners. Closes: #308597
  * pg_wrapper: If PGHOST is not defined, set it to the cluster's socket
    directory to make client programs work with non-default socket
    directories.

 -- Martin Pitt <mpitt@debian.org>  Sun, 22 May 2005 22:22:38 +0200

postgresql-common (8) experimental; urgency=low

  * pg_ctlcluster: Check whether owner is in the shadow group, and keep shadow
    group privilege in this case; this is a poor workaround for Perl's lack of
    an initgroups() functions. Closes: #305427
  * debian/postgresql-common.postinst: Fix adduser invocation, set home
    directory to /var/lib/postgresql. Closes: #308589
  * Remove pg_default.1 and pg_exec.1, these programs do not exist.  Closes:
    #305724
  * debian/postgresql-common.links: Add a symlink postgresql-common(7) to
    pg_wrapper(1) to make finding the manpage a bit more obvious.
  * PgCommon.pm, user_cluster_map(): If there are no clusters, use the latest
    version; this makes it possible to use remote clusters with no local ones.
    Closes: #306836

 -- Martin Pitt <mpitt@debian.org>  Fri, 13 May 2005 00:35:35 +0200

postgresql-common (7) experimental; urgency=low

  * Fix warning when calling pg_wrapper with an invalid cluster.
  * PgCommon.pm, user_cluster_map(): If only one cluster exists, return that
    if no match is found in the map files.
  * pg_ctlcluster: Start the postmaster under the locale that was used with
    initdb.
  * Updated documentation in architecture.html.

 -- Martin Pitt <mpitt@debian.org>  Wed, 20 Apr 2005 02:34:19 +0200

postgresql-common (6) experimental; urgency=low

  * pg_dropcluster: Check if postmaster and autovacuum log file paths are
    defined before unlinking them to avoid a warning. Closes: #303259
  * pg_ctlcluster: Documented the autovacuum stuff in the POD.
  * debian/init.d-functions: Add autovacuum commands.
  * debian/maintscripts-functions: (Re)start/stop autovacuum daemons on
    configuration/removal of p-contrib-*.
  * pg_ctlcluster, autovacuum_start(): Check for already running daemon before
    starting a new one.
  * pg_createcluster: Add an explicit "local all" entry for the database
    superuser to pg_hba.conf. Closes: #303274

 -- Martin Pitt <mpitt@debian.org>  Wed,  6 Apr 2005 20:59:28 +0200

postgresql-common (5) experimental; urgency=low

  * PgCommon.pm: Internalize get/set_conf_value, export get/set_cluster_port
    instead.
  * pg_ctlcluster: Integrated pg_autovacuum startup if -contrib is installed
    (based on some patches from Adam R. Skutt, thanks).
  * pg_createcluster: Create autovacuum_log symlink and log file.
  * pg_dropcluster: Remove autovacuum_log symlink and log file.
  * PgCommon.pm: If a configuration file is not found in the cluster conf dir,
    fall back to the one in /etc/postgresql-common.
  * Install /etc/postgresql-common/autovacuum.conf as a fallback default
    configuration file for pg_autovacuum.

 -- Martin Pitt <mpitt@debian.org>  Sun,  3 Apr 2005 09:10:27 +0200

postgresql-common (4) experimental; urgency=low

  * pg_upgradecluster: Uncomment library search path (artifact from
    debugging).
  * debian/postgresql-common.postinst: Don't create postgres user with home /,
    this can lead to problems sometimes.
  * pg_ctlcluster: Fixed pg_ctl invocation (dangling -o argument with versions
    < 8.0, caused errors when using dash as /bin/sh). Closes: #300896

 -- Martin Pitt <mpitt@debian.org>  Tue, 22 Mar 2005 23:32:47 +0100

postgresql-common (3) experimental; urgency=low

  * Add richer set of common maintainer scripts functions (for package
    removal, and also for client and contrib packages).
  * Use alternatives system to link manpages from
    /usr/share/postgresql/<version>/man/... to /usr/share/man.

 -- Martin Pitt <mpitt@debian.org>  Mon, 21 Mar 2005 00:33:22 +0100

postgresql-common (2) experimental; urgency=low

  * pg_wrapper: Check that specified cluster actually exists.
  * Fix some Perl warnings.
  * Added initial version of pg_upgradecluster(8).

 -- Martin Pitt <mpitt@debian.org>  Mon, 14 Mar 2005 17:51:22 +0100

postgresql-common (1) experimental; urgency=low

  * New package to provide a common infrastructure for different PostgreSQL
    versions. This finally fixes all bugs concerning failed automatic
    upgrades. Closes: #277700, #282803, #224047, #229240, #232553, #279184,
    #241337, #247261, #157282, #167864, #305347
  * pg_wrapper now has a central role for mapping clients to clusters, so it
    is not "overkill" any more. Closes: #201702

 -- Martin Pitt <mpitt@debian.org>  Sun, 20 Feb 2005 23:54:54 +0100

